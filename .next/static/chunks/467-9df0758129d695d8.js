"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[467],{4499:function(e,t,r){r.d(t,{I8:function(){return l},Vv:function(){return u},db:function(){return s}});var n=r(994),o=r(7007),i=r(4086);let a=(0,n.ZF)({apiKey:"AIzaSyAI2xRQDQ2ZTkPCOxb0CLE826BpX-VRQu4",authDomain:"pick-duel.firebaseapp.com",projectId:"pick-duel",storageBucket:"pick-duel.firebasestorage.app",messagingSenderId:"443838139867",appId:"1:443838139867:web:73372df5df72ece9602bfe"}),l=(0,o.v0)(a),s=(0,i.ad)(a),u=new o.hJ;u.setCustomParameters({prompt:"select_account"})},4138:function(e,t,r){function n(e){switch(e){case 0:return"Waiting for both players to submit options";case 1:return"Player 1 eliminates one option from Player 2";case 2:return"Player 2 eliminates one option from Player 1";case 3:return"Player 1 eliminates one of their own options";case 4:return"Player 2 eliminates one of their own options";default:return"Voting on final options"}}function o(e){return e.votingTurn||null}function i(e,t){let r=Object.keys(e.players);if(2!==r.length)return[];let[n,o]=r,i=e.players[t],a=e.players[t===n?o:n];switch(e.eliminationStep){case 1:return a.options.filter(e=>!a.eliminated.includes(e));case 2:return a.options.filter(e=>!a.eliminated.includes(e));case 3:return i.options.filter(e=>!i.eliminated.includes(e));case 4:return i.options.filter(e=>!i.eliminated.includes(e));default:return[]}}function a(e){let t=[];return Object.values(e.players).forEach(e=>{let r=e.options.filter(t=>!e.eliminated.includes(t));t.push(...r)}),t}function l(e,t){switch(e.toLowerCase()){case"movies":return 1===t?"\uD83C\uDFAC":"\uD83D\uDCFD️";case"cuisines":return 1===t?"\uD83C\uDF2E":"\uD83C\uDF63";case"restaurants":return 1===t?"\uD83E\uDDD1‍\uD83C\uDF73":"\uD83C\uDF7D️";case"travel destinations":return 1===t?"\uD83C\uDFD6️":"\uD83C\uDFD4️";case"names":return 1===t?"⭐️":"❤️";default:return 1===t?"\uD83C\uDFC6":"\uD83D\uDE80"}}r.d(t,{RC:function(){return n},bK:function(){return l},oK:function(){return i},qi:function(){return a},yu:function(){return o}})},1077:function(e,t,r){r.d(t,{f:function(){return a},q:function(){return i}});var n=r(965);let o={dictionaries:[n.Dv,n.O9,n.yd],separator:"-",length:3};function i(){return(0,n._8)(o).toLowerCase()}function a(e){return/^[a-z]+-[a-z]+-[a-z]+$/.test(e)}},9467:function(e,t,r){r.d(t,{Mx:function(){return d},gT:function(){return u},qj:function(){return c}});var n=r(4660),o=r(4086),i=r(7007),a=r(4499),l=r(1077),s=r(4138);let u=(0,n.Ue)((e,t)=>({user:null,room:null,step:0,loading:!1,error:null,setUser:t=>e({user:t}),setLoading:t=>e({loading:t}),setError:t=>e({error:t}),resetGame:()=>e({room:null,step:0,error:null}),joinRoom:async r=>{let{user:n}=t();if(!n)throw Error("User not authenticated");e({loading:!0,error:null});try{let t=(0,o.JU)(a.db,"rooms",r),i=await (0,o.QT)(t);if(!i.exists())throw Error("Room not found");let l=i.data();if(Object.keys(l.players).length>=2)throw Error("Room is full");let s={displayName:n.displayName||"Anonymous",avatar:n.photoURL||"",options:[],eliminated:[],vote:null};await (0,o.r7)(t,{["players.".concat(n.uid)]:s});let u=(0,o.cf)(t,t=>{if(t.exists()){let r=t.data();e({room:r})}});window.roomUnsubscribe=u}catch(t){e({error:t instanceof Error?t.message:"Failed to join room"})}finally{e({loading:!1})}},createRoom:async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"custom",{user:n}=t();if(!n)throw Error("User not authenticated");e({loading:!0,error:null});try{let t=(0,l.q)(),i=(0,o.JU)(a.db,"rooms",t),s={displayName:n.displayName||"Anonymous",avatar:n.photoURL||"",options:[],eliminated:[],vote:null},u={roomId:t,createdAt:(0,o.Bt)(),createdBy:n.uid,category:r,players:{[n.uid]:s},eliminationStep:0,votingTurn:null,finalOptions:[],winner:null,status:"waiting"};await (0,o.pl)(i,u);let c=(0,o.cf)(i,t=>{if(t.exists()){let r=t.data();e({room:r})}});return window.roomUnsubscribe=c,t}catch(t){throw e({error:t instanceof Error?t.message:"Failed to create room"}),console.error("Create room error:",t),t}finally{e({loading:!1})}},submitOptions:async r=>{let{user:n,room:i}=t();if(!n||!i)throw Error("User or room not found");if(3!==r.length)throw Error("Must submit exactly 3 options");e({loading:!0,error:null});try{let e=(0,o.JU)(a.db,"rooms",i.roomId);await (0,o.r7)(e,{["players.".concat(n.uid,".options")]:r});let t={...i.players,[n.uid]:{...i.players[n.uid],options:r}};if(Object.values(t).every(e=>3===e.options.length)){let t=i.createdBy;await (0,o.r7)(e,{status:"playing",eliminationStep:1,votingTurn:t})}}catch(t){e({error:t instanceof Error?t.message:"Failed to submit options"})}finally{e({loading:!1})}},eliminateOption:async r=>{let{user:n,room:i}=t();if(!n||!i)throw Error("User or room not found");if(i.votingTurn===n.uid){e({loading:!0,error:null});try{let e=i.createdBy,t=Object.keys(i.players).find(t=>t!==e);if(!e||!t)throw Error("Both players not found");let l=(0,o.JU)(a.db,"rooms",i.roomId),s=n.uid;1===i.eliminationStep?s=t:2===i.eliminationStep&&(s=e);let u=[...i.players[s].eliminated,r];await (0,o.r7)(l,{["players.".concat(s,".eliminated")]:u,revealElimination:{option:r,by:n.uid},eliminationAck:{[n.uid]:!1,...Object.fromEntries([e,t].filter(e=>e!==n.uid).map(e=>[e,!1]))}})}catch(t){console.error("Error in eliminateOption:",t),e({error:t instanceof Error?t.message:"Failed to eliminate option"})}finally{e({loading:!1})}}},acknowledgeEliminationReveal:async()=>{let{user:r,room:n}=t();if(r&&n&&n.revealElimination){e({loading:!0,error:null});try{let e=n.createdBy,t=Object.keys(n.players).find(t=>t!==e);if(!e||!t)throw Error("Both players not found");let i=(0,o.JU)(a.db,"rooms",n.roomId),l={...n.eliminationAck||{},[r.uid]:!0};if(await (0,o.r7)(i,{eliminationAck:l}),[e,t].every(e=>l[e])){let a=n.eliminationStep+1,l={revealElimination:null,eliminationAck:{}};if(a<=4)l.eliminationStep=a,2===a||4===a?l.votingTurn=t:l.votingTurn=e,await (0,o.r7)(i,l);else{let a={...n,players:{...n.players,[r.uid]:{...n.players[r.uid],eliminated:[...n.players[r.uid].eliminated,n.revealElimination.option]}}},u=(0,s.qi)(a);for(let r of(l.status="voting",l.finalOptions=u,l.voteRound=1,l.votingTurn=e,[e,t]))l["players.".concat(r,".vote")]=null;l.finalVotesSubmitted={},await (0,o.r7)(i,l)}}}catch(t){console.error("Error in acknowledgeEliminationReveal:",t),e({error:t instanceof Error?t.message:"Failed to acknowledge elimination reveal"})}finally{e({loading:!1})}}},vote:async r=>{let{user:n,room:i}=t();if(!n||!i)throw Error("User or room not found");let l=i.createdBy,s=Object.keys(i.players).find(e=>e!==l);if(!l||!s)throw Error("Both players not found");let u=2===i.finalOptions.length;if(u){if(i.players[n.uid].vote)return}else if(i.votingTurn!==n.uid||i.players[n.uid].vote)return;e({loading:!0,error:null});try{let e=(0,o.JU)(a.db,"rooms",i.roomId);await (0,o.r7)(e,{["players.".concat(n.uid,".vote")]:r});let t={...i.players,[n.uid]:{...i.players[n.uid],vote:r}},c=Object.values(t).map(e=>e.vote),d=c.filter(Boolean).length;if(u){if(2===d){let[t,r]=c;if(t===r)await (0,o.r7)(e,{status:"complete",winner:t,randomWinner:!1,votingTurn:null});else{let n=i.voteRound||1;if(n<2){let t={};for(let e of[l,s])t["players.".concat(e,".vote")]=null;await (0,o.r7)(e,{...t,voteRound:n+1})}else await (0,o.r7)(e,{status:"complete",winner:.5>Math.random()?t:r,randomWinner:!0,votingTurn:null})}}}else if(1===d){let t=[l,s].find(e=>e!==n.uid);await (0,o.r7)(e,{votingTurn:t,["players.".concat(t,".vote")]:null})}else if(2===d){let[t,r]=c;if(t===r)await (0,o.r7)(e,{status:"complete",winner:t,randomWinner:!1,votingTurn:null});else{let n=i.voteRound||1;if(n<2){let t={};for(let e of[l,s])t["players.".concat(e,".vote")]=null;await (0,o.r7)(e,{...t,voteRound:n+1,votingTurn:l})}else await (0,o.r7)(e,{status:"complete",winner:.5>Math.random()?t:r,randomWinner:!0,votingTurn:null})}}}catch(t){e({error:t instanceof Error?t.message:"Failed to vote"})}finally{e({loading:!1})}}})),c=async()=>{try{let e=await (0,i.rh)(a.I8,a.Vv);u.getState().setUser(e.user)}catch(e){console.error("Sign in error:",e)}},d=async()=>{try{await (0,i.w7)(a.I8),u.getState().setUser(null),u.getState().resetGame(),window.roomUnsubscribe&&(window.roomUnsubscribe(),window.roomUnsubscribe=null)}catch(e){console.error("Sign out error:",e)}}}}]);